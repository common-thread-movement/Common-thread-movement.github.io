<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Common Thread · Field Kit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#000000">

  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">

  <style>
    /* Hidden unless app is opened in standalone mode */
    #appTools {
      display: none;
      margin-top: 2rem;
    }
    .small-note {
      font-size: 0.8rem;
      opacity: 0.65;
    }
  </style>
</head>

<body>

<header>
  <h1>Common Thread · Field Kit</h1>
  <p>Quiet operations for responsible citizens.</p>
</header>

<section class="content-box">

  <h2>Field Documents</h2>
  <p>Tap any document below to open it:</p>

  <ul>
    <li><a href="docs/Fourpages.pdf" target="_blank">CT-PRC-004 — Principles Package</a></li>
    <li><a href="docs/handbook.pdf" target="_blank">CT-HBK-001 — Internal Handbook (Restricted)</a></li>
    <li><a href="docs/Fieldkit.pdf" target="_blank">CT-FLD-010 — Field Kit (Operator)</a></li>
  </ul>

  <hr>

  <h2>Using the Field Kit as an App</h2>
  <p><strong>On iPhone/iPad:</strong> open this page in Safari → Share → Add to Home Screen.</p>
  <p><strong>On Android:</strong> open in Chrome → Menu (⋮) → Add to Home Screen.</p>
  <p class="small-note">Operator tools appear automatically when opened from your Home Screen.</p>

  <!-- APP-ONLY SECTION -->
  <div id="appTools">

    <hr>

    <h2>Daily Civic Posture Checklist</h2>
    <form id="dailyChecklist">

      <label><input type="checkbox" id="chk1"> 3-second pause before responding</label><br>
      <label><input type="checkbox" id="chk2"> Observed instead of reacting</label><br>
      <label><input type="checkbox" id="chk3"> Avoided unverified information</label><br>
      <label><input type="checkbox" id="chk4"> Admitted “I don’t know” when needed</label><br>
      <label><input type="checkbox" id="chk5"> Corrected self/side when wrong</label><br>
      <label><input type="checkbox" id="chk6"> Disagreed respectfully</label><br>
      <label><input type="checkbox" id="chk7"> Treated others as humans not tribes</label><br>
      <label><input type="checkbox" id="chk8"> De-escalated a moment</label><br>
      <label><input type="checkbox" id="chk9"> Avoided fueling conflict</label><br>
      <label><input type="checkbox" id="chk10"> Quietly helped someone</label><br>
      <label><input type="checkbox" id="chk11"> Quiet personal uplift</label><br>
      <label><input type="checkbox" id="chk12"> Maintained boundaries</label><br>
      <label><input type="checkbox" id="chk13"> Avoided guilt-pressure</label><br>
      <label><input type="checkbox" id="chk14"> Acted within law</label><br>
      <label><input type="checkbox" id="chk15"> Avoided harm to movement</label><br>
      <label><input type="checkbox" id="chk16"> Remained grounded & non-tribal</label><br>

      <p style="margin-top:1rem;">Improvement focus for tomorrow:</p>
      <textarea id="improveTxt" rows="3" style="width:100%;"></textarea>

      <br><br>
      <button type="button" onclick="saveChecklist()">Save Today</button>
      <button type="button" onclick="resetToday()" style="margin-left:0.6rem;">Reset</button>
    </form>

    <p id="saveMessage" style="color:#44ff44; font-weight:bold;"></p>

    <hr>

    <h2>Community Bags of Trash</h2>
    <div style="text-align:center;">
      <div style="opacity:0.7;">TOTAL BAGS</div>
      <div id="bagCount" style="font-size:2rem; font-weight:bold;">0</div>
      <button onclick="addBag()">+1 Bag</button>
      <button onclick="undoBag()" style="margin-left:0.5rem;">Undo</button>
    </div>

    <hr>

    <h2>Daily Score</h2>
    <div style="text-align:center;">
      <div>Score Today</div>
      <div id="scoreToday" style="font-size:2rem; font-weight:bold;">0</div>

      <div style="margin-top:0.5rem;">Personal Best</div>
      <div id="scoreBest" style="font-size:1.4rem; font-weight:bold;">0</div>
    </div>

  </div>

</section>


<script>
  // Detect app mode
  function inStandalone() {
    return (
      window.matchMedia('(display-mode: standalone)').matches ||
      window.navigator.standalone === true
    );
  }

  // Show tools ONLY when in app mode
  document.addEventListener("DOMContentLoaded", function() {
    if (inStandalone()) {
      document.getElementById("appTools").style.display = "";
    }
    loadAll();
  });

  function saveChecklist() {
    let score = 0;
    for (let i = 1; i <= 16; i++) {
      const box = document.getElementById("chk" + i);
      if (box.checked) score++;
      localStorage.setItem("ct_chk" + i, box.checked);
    }

    const note = document.getElementById("improveTxt").value;
    if (note.trim() !== "") score++;
    localStorage.setItem("ct_note", note);

    const bags = parseInt(localStorage.getItem("ct_bags") || "0");
    score += bags;

    localStorage.setItem("ct_score", score);

    const best = parseInt(localStorage.getItem("ct_best") || "0");
    if (score > best) {
      localStorage.setItem("ct_best", score);
    }

    loadScores();
    document.getElementById("saveMessage").innerText = "Saved ✔";
  }

  function resetToday() {
    for (let i = 1; i <= 16; i++) {
      const box = document.getElementById("chk" + i);
      box.checked = false;
      localStorage.removeItem("ct_chk" + i);
    }
    document.getElementById("improveTxt").value = "";
    localStorage.removeItem("ct_note");
    localStorage.setItem("ct_score", "0");
    loadScores();
    document.getElementById("saveMessage").innerText = "Reset ✔";
  }

  function addBag() {
    let bags = parseInt(localStorage.getItem("ct_bags") || "0");
    bags++;
    localStorage.setItem("ct_bags", bags);
    loadBags();
  }

  function undoBag() {
    let bags = parseInt(localStorage.getItem("ct_bags") || "0");
    bags = Math.max(0, bags - 1);
    localStorage.setItem("ct_bags", bags);
    loadBags();
  }

  function loadAll() {
    loadChecklist();
    loadScores();
    loadBags();
  }

  function loadChecklist() {
    for (let i = 1; i <= 16; i++) {
      const stored = localStorage.getItem("ct_chk" + i);
      if (stored === "true") document.getElementById("chk" + i).checked = true;
    }
    const note = localStorage.getItem("ct_note") || "";
    document.getElementById("improveTxt").value = note;
  }

  function loadScores() {
    document.getElementById("scoreToday").innerText =
      localStorage.getItem("ct_score") || "0";
    document.getElementById("scoreBest").innerText =
      localStorage.getItem("ct_best") || "0";
  }

  function loadBags() {
    document.getElementById("bagCount").innerText =
      localStorage.getItem("ct_bags") || "0";
  }
</script>

</body>
</html>
